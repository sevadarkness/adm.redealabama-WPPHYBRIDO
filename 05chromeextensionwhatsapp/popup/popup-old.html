<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WhatsHybrid Lite</title>
  <link rel="stylesheet" href="popup.css" />
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="brand">
        <div class="logo">WH</div>
        <div class="titles">
          <h1>WhatsHybrid Lite</h1>
          <p class="muted">Configura√ß√µes ‚Ä¢ IA ‚Ä¢ Campanhas ‚Ä¢ Contatos</p>
        </div>
      </div>
    </header>

    <div class="card">
      <div class="cardTitle">Conex√£o</div>

      <label>Provider</label>
      <select id="provider">
        <option value="openai">OpenAI direto</option>
        <option value="backend">Backend (proxy)</option>
      </select>

      <label>OpenAI API Key</label>
      <div class="row">
        <div class="col">
          <input id="openaiApiKey" placeholder="sk-..." type="password" />
        </div>
        <button id="toggleKey" class="mini" type="button" title="Mostrar/ocultar">üëÅ</button>
      </div>

      <div class="row">
        <div class="col">
          <label>Modelo (OpenAI)</label>
          <input id="openaiModel" placeholder="gpt-4o-mini" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Temperatura</label>
          <input id="temperature" type="number" min="0" max="2" step="0.1" />
        </div>
        <div class="col">
          <label>Max tokens</label>
          <input id="maxTokens" type="number" min="50" max="4000" step="10" />
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardTitle">Backend (opcional)</div>

      <label>Backend URL</label>
      <input id="backendUrl" placeholder="https://seu-backend.com" />

      <label>Backend Secret (opcional)</label>
      <input id="backendSecret" placeholder="X-Alabama-Proxy-Key" />

      <div class="row">
        <div class="col">
          <label>AI path</label>
          <input id="backendAiPath" placeholder="/ai/chat.php" />
        </div>
        <div class="col">
          <label>Campanhas path</label>
          <input id="backendCampaignPath" placeholder="/api/campaigns.php" />
        </div>
      </div>

      <p class="hint">
        Use backend para IA e/ou campanhas pela API oficial. O modo DOM √© assistido dentro do WhatsApp Web.
      </p>
    </div>

    <div class="card">
      <div class="cardTitle">Chatbot (robustez)</div>

      <label>Persona / Regras (system)</label>
      <textarea id="persona" rows="4" placeholder="Ex.: Voc√™ √© um atendente premium. Seja objetivo, cordial e sempre confirme detalhes antes de prometer."></textarea>

      <label>Contexto do neg√≥cio (conhecimento)</label>
      <textarea id="businessContext" rows="5" placeholder="Cole aqui informa√ß√µes do neg√≥cio: produtos, pre√ßos, hor√°rios, pol√≠ticas, links, obje√ß√µes, tom de voz..."></textarea>

      <div class="row">
        <label class="check">
          <input type="checkbox" id="autoSuggest" />
          <span>Auto-sugerir respostas</span>
        </label>
        <label class="check">
          <input type="checkbox" id="autoMemory" />
          <span>Auto-mem√≥ria (Le√£o)</span>
        </label>
      </div>

      <p class="hint">
        Dica: No WhatsApp Web, use o bot√£o <b>ü§ñ</b> para abrir o painel.
      </p>
    </div>


    <div class="card">
      <div class="cardTitle">ü§ñ Modo Copiloto</div>
      
      <div class="copilot-status">
        <div class="confidence-header">
          <span>N√≠vel de Confian√ßa da IA</span>
          <span id="confidencePercent">0%</span>
        </div>
        
        <div class="confidence-bar">
          <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
          <div class="confidence-threshold" id="confidenceThreshold" style="left: 70%"></div>
        </div>
        
        <div class="confidence-level" id="confidenceLevel">
          <span class="level-emoji">üî¥</span>
          <span class="level-label">Iniciante</span>
          <span class="level-desc">IA apenas sugere respostas</span>
        </div>
      </div>
      
      <div class="copilot-controls">
        <div class="copilot-toggle">
          <label class="switch">
            <input type="checkbox" id="copilotEnabled">
            <span class="slider"></span>
          </label>
          <span id="copilotStatusText">Modo Copiloto Desativado</span>
        </div>
        
        <div class="copilot-threshold-control">
          <label>Meta para ativa√ß√£o autom√°tica:</label>
          <div class="row">
            <input type="range" id="copilotThreshold" min="50" max="95" value="70" step="5">
            <span id="thresholdValue">70%</span>
          </div>
        </div>
      </div>
      
      <div class="copilot-stats" id="copilotStats">
        <div class="stat-item">
          <span class="stat-icon">‚úÖ</span>
          <span class="stat-value" id="statGood">0</span>
          <span class="stat-label">Boas</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">‚ùå</span>
          <span class="stat-value" id="statBad">0</span>
          <span class="stat-label">Ruins</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">‚úèÔ∏è</span>
          <span class="stat-value" id="statCorrections">0</span>
          <span class="stat-label">Corre√ß√µes</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">üöÄ</span>
          <span class="stat-value" id="statAutoSent">0</span>
          <span class="stat-label">Auto-envios</span>
        </div>
      </div>
      
      <div class="copilot-info">
        <p class="hint" id="copilotHint">
          üìà <strong>Como aumentar a confian√ßa:</strong><br>
          ‚Ä¢ Marque respostas como ‚úÖ Boa no chat<br>
          ‚Ä¢ Use sugest√µes sem editar<br>
          ‚Ä¢ Cadastre FAQs e produtos na aba üß† IA
        </p>
        
        <div class="copilot-goal" id="copilotGoal">
          üéØ <strong>Faltam <span id="pointsToGoal">70</span> pontos</strong> para o Modo Copiloto
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardTitle">Mem√≥ria H√≠brida (Servidor)</div>

      <label>Memory Server URL</label>
      <input id="memoryServerUrl" placeholder="https://seu-servidor.com" />

      <div class="row">
        <div class="col">
          <label>Workspace Key</label>
          <input id="memoryWorkspaceKey" placeholder="chave-do-workspace" />
        </div>
        <div class="col">
          <label>Sync</label>
          <div class="check">
            <input id="memorySyncEnabled" type="checkbox" />
            <label for="memorySyncEnabled" class="muted">Sincronizar mem√≥rias</label>
          </div>
        </div>
      </div>

      <p class="hint">
        Mant√©m mem√≥ria local (cache) e sincroniza para um servidor para n√£o perder ao trocar de PC/navegador.
      </p>
    </div>

    <div class="actions">
      <button id="save" type="button" class="primary">Salvar</button>
    </div>

    <div id="status" class="status"></div>

    <footer class="foot">
      Use com consentimento. Automa√ß√£o agressiva pode causar bloqueios.
    </footer>
  </div>

  <script src="popup.js"></script>
</body>
</html>
